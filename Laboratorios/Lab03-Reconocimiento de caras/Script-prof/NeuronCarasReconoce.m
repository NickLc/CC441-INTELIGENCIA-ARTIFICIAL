% Entrenamiento patron

clear;
clc;
close all;

% Pixel blanco = 0 
% Pixel negro  = 1

cara1 = [0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 0 0 0 0 
 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 0 0 0
 0 0 0 0 0 1 1 1 1 1 0 0 0 0 1 1 1 0 0 0 
 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 1 1 1 0 0
 0 0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 1 1 0
 0 0 1 1 1 1 1 1 0 0 1 0 0 0 0 1 0 0 1 0 
 0 1 1 1 0 0 1 0 0 1 1 1 0 0 1 1 1 0 0 1 
 0 1 1 0 0 1 1 0 0 0 1 0 0 0 0 1 0 0 0 1 
 0 1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 
 1 1 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0 1 
 1 1 1 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0 1 
 0 1 0 0 0 1 0 0 0 0 0 1 1 1 0 0 0 0 0 1 
 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 1 0 
 0 0 0 0 0 0 1 0 0 0 1 0 0 0 1 0 0 1 1 0 
 0 0 0 0 0 0 1 1 0 0 0 1 1 1 0 0 1 1 0 0 
 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 1 0 0 0 
 0 0 0 0 0 0 1 1 1 1 0 0 0 0 0 1 1 0 0 0 
 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 
 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 ]; 

cara2 = [0 0 0 0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 
 0 0 0 0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 0 0 0 0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
 0 0 0 1 1 1 0 0 0 0 0 0 1 1 1 0 0 0 0 0
 0 0 0 1 1 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
 0 0 1 1 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0
 0 0 1 0 0 1 1 1 0 0 1 1 1 0 0 1 0 0 0 0
 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0
 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0
 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0
 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0
 0 0 1 1 0 0 0 1 1 1 1 0 0 1 1 0 0 0 0 0
 0 0 0 1 0 0 1 0 0 0 0 1 0 1 0 0 0 0 0 0
 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0
 0 0 0 0 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 ];

cara3 = [0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 
 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0  
 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 
 0 0 1 1 1 1 1 1 1 0 0 0 0 1 1 1 1 1 1 1 
 0 1 1 1 1 1 1 0 0 0 0 0 0 0 1 1 1 1 1 1 
 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 1 1 1 1 1 
 0 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 
 0 0 1 1 1 0 0 1 1 0 0 0 1 1 0 0 0 1 0 0 
 0 0 0 1 1 0 0 1 1 0 0 0 1 1 0 0 0 1 1 0 
 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0 1 1 0 
 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 0 
 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 0 
 0 0 0 1 0 0 0 0 0 1 1 1 0 0 0 0 0 0 1 0  
 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 
 0 0 0 1 1 0 0 0 1 1 1 1 1 0 0 0 0 1 0 0 
 0 0 0 0 1 0 0 1 0 0 0 0 0 1 0 0 1 1 0 0 
 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 1 1 0 0 0 
 0 0 0 0 0 1 1 1 0 0 0 0 0 1 1 1 0 0 0 0 
 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0 0 
 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 ]; 

cara4 = [ 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 
 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 
 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 
 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 
 0 1 1 1 1 1 0 0 0 0 0 1 1 1 1 1 1 1 1 1 
 0 0 0 0 1 0 0 0 0 0 0 0 0 1 1 1 1 0 0 0 
 0 0 0 0 1 0 0 0 0 0 0 0 0 0 1 1 1 0 0 0 
 0 0 0 1 0 0 1 1 1 0 0 1 1 1 0 0 1 1 0 0 
 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0 1 0 0 
 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0 1 0 0 
 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0 1 0 0 
 0 0 0 1 0 0 0 0 0 0 1 0 0 0 0 0 0 1 0 0 
 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 
 0 0 0 1 1 0 0 0 1 1 1 1 1 0 0 0 1 0 0 0 
 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 1 0 0 0 0 
 0 0 0 0 0 0 1 1 0 0 0 0 0 1 1 0 0 0 0 0 
 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 
 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 
 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 0 0 0 0 0 
 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 ];

[nf nc] = size(cara1);
x(1,:) = cara1(1,:);
x(2,:) = cara2(1,:);
x(3,:) = cara3(1,:);
x(4,:) = cara4(1,:);
for k = 2:nf
   caras = [ cara1(k,:)
             cara2(k,:)
             cara3(k,:)
             cara4(k,:) ];
   x = [ x  caras ];
end
[ nxf nxc ] = size(x);
nx = nxf;

yb(1,:) = [ 1 0 0 0 ]; 
yb(2,:) = [ 0 1 0 0 ]; 
yb(3,:) = [ 0 0 1 0 ]; 
yb(4,:) = [ 0 0 0 1 ]; 

[ nyf nyc ] = size(yb);
ny = nyf;

ne = nxc;
nm = 3;
ns = nyc;
bias = input('Bias:  SI = 1 : ');
if(bias == 1)
   ne = ne +1;
   x = [ x ones(nx,1) ];   
end
v = 0.2*(rand(ne,nm) - 0.5);
w = 0.2*(rand(nm,ns) - 0.5);
% load pesoscaras;

eta = input('eta pesos : ');

for iter = 1:3000
count(iter,1) = iter;
dJdw = 0;
dJdv = 0;
for k = 1:nx   
in = (x(k,:))';
m = v'*in;
n = 1.0./(1+exp(-m));    % Sigmoidea 1
%n = 2.0./(1+exp(-m)) - 1; % sigmoidea 2
%n = exp(-m.^2);         % Gaussiana
out = w'*n;
y(k,:) = out';
er = out - (yb(k,:))';
error(k,:) = er';
dndm = n.*(1 - n);       % Sigmoidea 1
%dndm = (1 - n.*n)/2;     % Sigmoidea 2
%dndm = -2.0*(n.*m);     % Gaussiana
dydw = n; 
dJdw = 1*dJdw + dydw*er';    
dJdv = 1*dJdv + in*((w*er).*dndm)';    
%w = w - eta*dJdw/nx;   
%v = v - eta*dJdv/nx;      
end
w = w - eta*dJdw/nx;   
v  = v - eta*dJdv/nx; 
JJ = 0.5*sum(sum(error.*error))
J(iter,1) = JJ;
end

save pesoscaras ne ns nm v w  bias; 

figure(1);
plot(y(1,:),'or');   % Se grafica sin redondeo
hold on;
plot(yb(1,:),'*b');

figure(2);
plot(count,J);

